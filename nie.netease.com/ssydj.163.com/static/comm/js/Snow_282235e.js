!function(){function e(e,t){return Math.random()*(t-e)+e}var t,i;Particle3D=function(t){THREE.Particle.call(this,t),this.velocity=new THREE.Vector3(0,-4,0),this.velocity.rotateX(e(45,45)),this.velocity.rotateY(e(-45,-45)),this.gravity=new THREE.Vector3(0,0,0),this.drag=1},Particle3D.prototype=new THREE.Particle,Particle3D.prototype.constructor=Particle3D,Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag),this.velocity.addSelf(this.gravity),this.position.addSelf(this.velocity)};var r=Math.PI/180;THREE.Vector3.prototype.rotateY=function(e){t=Math.cos(e*r),i=Math.sin(e*r);var n=this.z,a=this.x;this.x=a*t+n*i,this.z=a*-i+n*t},THREE.Vector3.prototype.rotateX=function(e){t=Math.cos(e*r),i=Math.sin(e*r);var n=this.z,a=this.y;this.y=a*t+n*i,this.z=a*-i+n*t},THREE.Vector3.prototype.rotateZ=function(e){t=Math.cos(e*r),i=Math.sin(e*r);var n=this.x,a=this.y;this.y=a*t+n*i,this.x=a*-i+n*t}}();var Top=Top||{};!function(e){Top.snow=function(){var t=this.snow,i={container:"",particle:"",camera:"",scene:"",renderer:"",mouseX:0,mouseY:0,snownum:10,screen_width:e(window).width(),screen_height:e(document).height(),particles:[],particleImage:new Image},r=t.param=i,n=t.func={};return n.init=function(){r.particleImage.src=e("#huaban_pic").attr("src"),r.container=document.getElementById("snow-canvas"),r.camera=new THREE.PerspectiveCamera(75,r.screen_width/r.screen_height,1,1e4),r.camera.position.z=1e3,r.scene=new THREE.Scene,r.scene.add(r.camera),r.renderer=new THREE.CanvasRenderer,r.renderer.setSize(r.screen_width,r.screen_height);for(var i=new THREE.ParticleBasicMaterial({map:new THREE.Texture(r.particleImage)}),a=0;a<r.snownum;a++)r.particle=new Particle3D(i),r.particle.position.x=2e3*Math.random()-1e3,r.particle.position.y=2e3*Math.random()-1e3,r.particle.position.z=2e3*Math.random()-1e3,r.particle.scale.x=r.particle.scale.y=1,r.scene.add(r.particle),r.particles.push(r.particle);return r.container.appendChild(r.renderer.domElement),setInterval(n.loop,1e3/60),e(window).on("resize",n.resetvalue),t},n.resetvalue=function(){r.screen_width=e(window).width(),r.screen_height="2105",r.renderer.setSize(r.screen_width,r.screen_height),r.camera.aspect=r.screen_width/r.screen_height,r.camera.updateProjectionMatrix()},n.loop=function(){for(var e=0;e<r.particles.length;e++){var t=r.particles[e];t.updatePhysics(),t.position.y<-1e3&&(t.position.y+=2e3),t.position.x>1e3?t.position.x-=2e3:t.position.x<-1e3&&(t.position.x+=2e3),t.position.z>1e3?t.position.z-=2e3:t.position.z<-1e3&&(t.position.z+=2e3)}r.camera.position.x+=.02*(r.mouseX-r.camera.position.x),r.camera.position.y+=.02*(-r.mouseY-r.camera.position.y),r.camera.lookAt(r.scene.position),r.renderer.render(r.scene,r.camera)},n.init()},Top.snow()}(jQuery);